<!DOCTYPE html>
<html>
<head>
<style>
table, th, td {
  border: 1px solid white;
  border-collapse: collapse;
}
td.cnt {
  text-align: center;
}
tr:nth-child(even) {
  background-color: #3f3f3f;
}
body {
  background-color: #1a1a1a;
  color: #d7dadc;
  font-family: Monaco, monospace;
}
</style>
</head>
<body>

<h2>A Dumb Time Calculator for Ocean Fishing</h2>

<p>Use this stupid box to select a date that you want to see.</p>

<label for="myDate"> Date:</label>
<input type="date" id="myDate">
<button onclick="convertTime()">Submit</button>



<p>Here are the 12 patterns that day:</p>

<p id="demo"></p>

<h2>Or select a route and know what the next upcoming times for that route are.</h2>

<p>Use these two stupid boxes to select what you want to see, and how many.</p>

<label for="routeNumber">Route: </label>
<select id="routeNumber">
  <option value="1">Sea Dragon + Coral</option>
  <option value="2">Octo</option>
  <option value="3">Sothis + Elasmo</option>
  <option value="4">Sothis + Stonescale</option>
  <option value="5">Jelly</option>
  <option value="6">Shark + Coral</option>
</select></br>
<label for="printQuantity">Number to Print:</label><input type="number" id="printQuantity" min="1" max="999" value="10">
<button onclick="printRoutes()">Submit</button>

<p id="poop"></p>

<!-- 
If you can see this, consider funding my chocolate addiction
BTC:  1DonutSAQzU7uAyDQBfp3yfpjRxH8btMtf
LTC:  LdSTEELqdiwcqU6oG9YNSPUcbgNmbGF15v
DOGE: DPastrybfBtdHzvw2YPHjHyy8cbN2ZECjN
-->

<script>
var pattern = [1,4,2,5,3,6,1,4,2,5,3,6,
4,1,5,2,6,3,4,1,5,2,6,3,
2,5,3,6,1,4,2,5,3,6,1,4,
5,2,6,3,4,1,5,2,6,3,4,1,
3,6,1,4,2,5,3,6,1,4,2,5,
6,3,4,1,5,2,6,3,4,1,5,2]

var routeNames = ["Sea Dragon + Coral", "Octo", "Sothis + Elasmo", "Sothis + Stonescale", "Jelly", "Shark + Coral"]

var schedules = ["South at Night, Galadion at Day, North at Sunset",
"South at Day, Galadion at Sunset, North at Night",
"South at Sunset, Galadion at Night, North at Day",
"Galadion at Night, South at Day, Rhotano at Sunset",
"Galadion at Day, South at Sunset, Rhotano at Night",
"Galadion at Sunset, South at Night, Rhotano at Day"]


var timeRegion = 'en-US';
var timeFormat = { weekday: 'short', month: 'short', day: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', timeZoneName:'short'};


//Force myDate box to start at today's date
//thank you stackoverflow
var date = new Date();
var day = date.getDate();
var month = date.getMonth() + 1;
var year = date.getFullYear();
if (month < 10) month = "0" + month;
if (day < 10) day = "0" + day;
var today = year + "-" + month + "-" + day;       
document.getElementById("myDate").value = today;

function convertTime() {
  var x = document.getElementById("myDate").value;
  var selectedTime = new Date(x);
  
  var selectedTwoHourChunk = Math.floor(selectedTime.getTime() / 1000 / (60*60*2));
  
  var offset = 20;
  
  var tempTime = (selectedTwoHourChunk + offset) % 72;
  
  var temptext = "";
  
  //add tables for formatting
  temptext += "<table><tr><th>Time</th><th>Route</th><th>Comment</th><th>Schedule</th></tr>";
  
  for (var i = 0; i < 12; i++) {
    var temp = ((tempTime + i >= 72) ? (tempTime + i - 72):(tempTime + i));
    temptext += "<tr><td>";
    var tempoop = new Date((selectedTwoHourChunk + i + 4) * (1000*60*60*2));
	temptext += tempoop.toLocaleString(timeRegion, timeFormat);
    temptext += "</td><td class='cnt'>";
    temptext += pattern[temp];
    temptext += "</td><td>";
    temptext += routeNames[pattern[temp]-1];
    temptext += "</td><td>";
    temptext += schedules[pattern[temp]-1];
    temptext += "</td></tr>";
   }
   
   temptext += "</table>";
  
  document.getElementById("demo").innerHTML = temptext;
}

function printRoutes() {
  var rN = document.getElementById("routeNumber").value;
  var pQ = document.getElementById("printQuantity").value;
  
  var currentTime = new Date();
  var currentTwoHourChunks = Math.floor(currentTime.getTime() / 1000 / (60*60*2));
  
  //modify this offset as a crude way of modifying time zones and daylight savings
  var offset = 16;
  
  var temptime = currentTwoHourChunks % 72;
  
  var temptext = "";
  
  //temptext += "Current chunk " + currentTwoHourChunks + ", pattern " + temptime + ", Route is #" + pattern[temptime+offset] + "</br>";
  //temptext += pQ + "</br></br>";
  
  temptext += "<table><tr><th>Times</th></tr>";
  
  var tries = 0;
  var matches = 0;
  var matchedTimes = [];
  
  while (matches < pQ && tries < pQ*20) {
    //ADD offset to find pattern
    var temp = currentTwoHourChunks + tries + offset;
    if (pattern[(temp % 72)] == rN) {
      matchedTimes.push(temp);
      matches++;
    }
    tries++;
  }
  
  for (var i = 0; i < matchedTimes.length; i++) {
    temptext +="<tr><td>";
    //convert from twoHourChunks to real time
    //SUBTRACT offset to get real time
    var tempoop = new Date((matchedTimes[i] - offset) * (1000*60*60*2));
    temptext += tempoop.toLocaleString(timeRegion, timeFormat);
    temptext +="</td></tr>";
  }
  
  temptext += "</table>";
  
  document.getElementById("poop").innerHTML = temptext;
}
</script>

</body>
</html>
